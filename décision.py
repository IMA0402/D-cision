import streamlit as st
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import arabic_reshaper
from bidi.algorithm import get_display
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import accuracy_score

# ๐น 1. ุถุจุท ุงุชุฌุงู ุงููุตูุต ูู Streamlit
st.markdown(
    """
    <style>
    * {
        direction: rtl;
        text-align: right;
    }
    </style>
    """,
    unsafe_allow_html=True
)

# ๐ ุฅุนุฏุงุฏ ุงูุฎุท ูุฏุนู ุงูุนุฑุจูุฉ
plt.rcParams['font.family'] = 'Arial'
plt.rcParams['axes.unicode_minus'] = False

# ๐ ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุชุทุจูู
st.title("๐ ุชุทุจูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุญููู ุงูุญููุงุช ุงูุชุณููููุฉ")
st.write("๐ ุฃุฏุฎู ุจูุงูุงุช ุญููุชู ุงูุชุณููููุฉ ููุญุตูู ุนูู ุชูุตูุงุช ุชุนุชูุฏ ุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู.")

# ๐ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุญููุฉ
ุงูููุฒุงููุฉ = st.number_input("๐ฐ ููุฒุงููุฉ ุงูุญููุฉ (ุงูุฏุฑูู ุงููุบุฑุจู):", min_value=1000, max_value=100000, step=500)
ุงูููุงุฉ = st.selectbox("๐ก ุงูููุงุฉ ุงูุชุณููููุฉ:", ["ุฅุนูุงูุงุช ุฑูููุฉ", "ูุณุงุฆู ุงูุชูุงุตู", "ุชููุฒููู", "ุฑุงุฏูู", "ุจุฑูุฏ ุฅููุชุฑููู"])
ุงูุฌูููุฑ = st.selectbox("๐ฅ ุงููุฆุฉ ุงููุณุชูุฏูุฉ:", ["18-24", "25-34", "35-44", "45-54", "55+"])
ุงููุฏุฉ = st.number_input("โณ ูุฏุฉ ุงูุญููุฉ (ุจุงูุฃูุงู):", min_value=7, max_value=90, step=7)
ุญุงูุฉ_ุงูุณูู = st.selectbox("๐ ุญุงูุฉ ุงูุณูู:", ["ุทุจูุนูุฉ", "ุฃุฒูุฉ ููุฑููุง", "ุฃุฒูุฉ ุงูุชุตุงุฏูุฉ"])

# ุฒุฑ ุชุญููู ุงูุจูุงูุงุช - ุฃุถููุง ููุง ุฒุฑ ููุชุญููู
ุชุญููู_ุงูุจูุงูุงุช = st.button("๐ ุชุญููู ุงูุจูุงูุงุช")

# ุฃุถููุง ููุทู ุดุฑุทู ูุนุฑุถ ุงูุชุญููู ููุท ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ
if ุชุญููู_ุงูุจูุงูุงุช:
    # ๐ ูุนุงูุฌุฉ ุงูุจูุงูุงุช
    df = pd.DataFrame({
         "ุงูููุฒุงููุฉ": np.random.randint(1000, 50000, 100),
         "ุงูููุงุฉ": np.random.choice(["ุฅุนูุงูุงุช ุฑูููุฉ", "ูุณุงุฆู ุงูุชูุงุตู", "ุชููุฒููู", "ุฑุงุฏูู", "ุจุฑูุฏ ุฅููุชุฑููู"], 100),
         "ุงูุฌูููุฑ": np.random.choice(["18-24", "25-34", "35-44", "45-54", "55+"], 100),
         "ุงููุฏุฉ": np.random.randint(7, 90, 100),
         "ุญุงูุฉ_ุงูุณูู": np.random.choice(["ุทุจูุนูุฉ", "ุฃุฒูุฉ ููุฑููุง", "ุฃุฒูุฉ ุงูุชุตุงุฏูุฉ"], 100),
         "ุงููุฌุงุญ": np.random.choice([0, 1], 100)
    })

    # ๐ ุชุฑููุฒ ุงูููู (ุฅูุดุงุก ุชุฑููุฒ ูููุตู ููู ุนููุฏ)
    le_ุงูููุงุฉ = LabelEncoder()
    df["ุงูููุงุฉ"] = le_ุงูููุงุฉ.fit_transform(df["ุงูููุงุฉ"])

    le_ุงูุฌูููุฑ = LabelEncoder()
    df["ุงูุฌูููุฑ"] = le_ุงูุฌูููุฑ.fit_transform(df["ุงูุฌูููุฑ"])

    le_ุญุงูุฉ_ุงูุณูู = LabelEncoder()
    df["ุญุงูุฉ_ุงูุณูู"] = le_ุญุงูุฉ_ุงูุณูู.fit_transform(df["ุญุงูุฉ_ุงูุณูู"])

    # ๐ ุฅุนุฏุงุฏ ุงูุจูุงูุงุช
    X = df[["ุงูููุฒุงููุฉ", "ุงูููุงุฉ", "ุงูุฌูููุฑ", "ุงููุฏุฉ", "ุญุงูุฉ_ุงูุณูู"]]
    y = df["ุงููุฌุงุญ"]
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # ๐ ุชุฏุฑูุจ ุงููููุฐุฌ
    model = RandomForestClassifier(n_estimators=100, random_state=42)
    model.fit(X_train, y_train)

    # ๐ ุชุญููู ุงูููุฒุงุช
    importances = model.feature_importances_
    importance_df = pd.DataFrame({"ุงูููุฒุฉ": X.columns, "ุงูุฃูููุฉ": importances}).sort_values(by="ุงูุฃูููุฉ", ascending=False)

    # ๐ ุฏูุฉ ุงููููุฐุฌ
    accuracy = accuracy_score(y_test, model.predict(X_test))
    st.write(f"๐ **ุฏูุฉ ุงููููุฐุฌ: {accuracy * 100:.2f} ูู ุงููุฆุฉ**")

    # ๐ ุชูุณูุฑ ุงููุชุงุฆุฌ
    # ุงูุชุญูู ูู ูุฌูุฏ ุงููุฆุงุช ุงูุฌุฏูุฏุฉ ูุฅุถุงูุชูุง ุฅุฐุง ูุฒู ุงูุฃูุฑ
    if ุงูููุงุฉ not in le_ุงูููุงุฉ.classes_:
        le_ุงูููุงุฉ.classes_ = np.append(le_ุงูููุงุฉ.classes_, ุงูููุงุฉ)
    if ุงูุฌูููุฑ not in le_ุงูุฌูููุฑ.classes_:
        le_ุงูุฌูููุฑ.classes_ = np.append(le_ุงูุฌูููุฑ.classes_, ุงูุฌูููุฑ)
    if ุญุงูุฉ_ุงูุณูู not in le_ุญุงูุฉ_ุงูุณูู.classes_:
        le_ุญุงูุฉ_ุงูุณูู.classes_ = np.append(le_ุญุงูุฉ_ุงูุณูู.classes_, ุญุงูุฉ_ุงูุณูู)

    # ุงูุชูุจุค
    new_data = pd.DataFrame([[ุงูููุฒุงููุฉ, le_ุงูููุงุฉ.transform([ุงูููุงุฉ])[0], le_ุงูุฌูููุฑ.transform([ุงูุฌูููุฑ])[0], ุงููุฏุฉ, le_ุญุงูุฉ_ุงูุณูู.transform([ุญุงูุฉ_ุงูุณูู])[0]]],
                            columns=["ุงูููุฒุงููุฉ", "ุงูููุงุฉ", "ุงูุฌูููุฑ", "ุงููุฏุฉ", "ุญุงูุฉ_ุงูุณูู"])

    prediction = model.predict(new_data)[0]
    result = "ูุฌุงุญ ๐ฏ" if prediction == 1 else "ูุดู โ๏ธ"

    # ๐ ุชูุฑูุฑ ุชุญูููู ุดุงูู
    analysis = f"""
    ๐ **ุชูุฑูุฑ ุชุญูููู ุดุงูู ุญูู ุฃุฏุงุก ุงูุญููุฉ ุงูุชุณููููุฉ**  
        
ุชู ุฅุฌุฑุงุก ุชุญููู ุดุงูู ููุญููุฉ ุงูุชุณููููุฉ ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงููุชุงุญุฉุ ูุน ุงูุชุฑููุฒ ุนูู ุงูููุฒุงููุฉุ ุงูููุงุฉ ุงูุชุณููููุฉุ ุงููุฆุฉ ุงููุณุชูุฏูุฉุ ููุฏุฉ ุงูุญููุฉ. ููุง ุชู ุฃุฎุฐ ุงูุนูุงูู ุงูุฎุงุฑุฌูุฉุ ูุซู ุญุงูุฉ ุงูุณููุ ุจุนูู ุงูุงุนุชุจุงุฑ ูุชูุฏูู ุชููุน ุฏููู ููุฃุฏุงุก ุงููุชููุน.  

    ๐ฐ **ุงูููุฒุงููุฉ ูุงูููุงุฉ ุงูุชุณููููุฉ:**  
- ุชู ุชุฎุตูุต ููุฒุงููุฉ ูุฏุฑูุง ** {ุงูููุฒุงููุฉ} ** ุฏุฑูู ููุญููุฉุ ููุง ูุคุซุฑ ุจุดูู ูุจุงุดุฑ ุนูู ูุฏู ุงููุตูู ูุงูุงุณุชุฑุงุชูุฌูุงุช ุงููุณุชุฎุฏูุฉ.  
- ุชู ุงุฎุชูุงุฑ ุงูููุงุฉ ุงูุชุณููููุฉ **{ุงูููุงุฉ}**ุ ูุงูุชู ุชูุนุจ ุฏูุฑูุง ููููุง ูู ุชุญุฏูุฏ ูุนุงููุฉ ุงูุญููุฉ ุจูุงุกู ุนูู ุชูุงุนู ุงูุฌูููุฑ ุนุจุฑ ูุฐู ุงูููุงุฉ.  

    ๐ฏ **ุชุญููู ุงููุฆุฉ ุงููุณุชูุฏูุฉ ููุฏุฉ ุงูุญููุฉ:**  
- ุงููุฆุฉ ุงููุณุชูุฏูุฉ ูู **{ุงูุฌูููุฑ}**ุ ููุง ูุนูู ุถุฑูุฑุฉ ุชุฎุตูุต ุงููุญุชูู ูุงุณุชุฑุงุชูุฌูุงุช ุงูุฅุนูุงูุงุช ุจูุง ูุชูุงุณุจ ูุน ุงูุชูุงูุงุชูู ูุณููููุงุชูู.  
- ูุฏุฉ ุงูุญููุฉ ูุญุฏุฏุฉ ุจู **{ุงููุฏุฉ} ุฃูุงู**ุ ููู ุนุงูู ููู ูู ุชุญุฏูุฏ ูุฏู ุชุฃุซูุฑ ุงูุญููุฉ ุนูู ุชุญููู ุงูุฃูุฏุงู ุงูุชุณููููุฉ.  

    ๐ **ุชุฃุซูุฑ ุญุงูุฉ ุงูุณูู ุนูู ูุฌุงุญ ุงูุญููุฉ:**  
- ุชู ุชูููู ูุถุน ุงูุณูู ุงูุญุงูู ุนูู ุฃูู **{ุญุงูุฉ_ุงูุณูู}**ุ ููุง ูุฏ ูุคุซุฑ ุนูู ุณููู ุงููุณุชููููู ูุงุณุชุฌุงุจุชูู ููุญููุฉ.  
- ูู ุญุงู ูุงู ุงูุณูู ูุนุงูู ูู ุฑููุฏ ุฃู ุชููุจุงุชุ ูุฏ ูููู ูู ุงููููุฏ ุชูููู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณููู ูููุงูุจุฉ ูุฐู ุงูุชุบูุฑุงุช.  

    ๐ **ูุชูุฌุฉ ุงูุชูุจุค:**  
# ููููุง ููุชุญููู ุงููุงุฆู ุนูู ุงูุจูุงูุงุช ุงูุญุงููุฉุ ููุชููุน ุฃู ุชุญูู ุงูุญููุฉ **{result}**.  
- ูุฐู ุงููุณุจุฉ ุชุดูุฑ ุฅูู ุฃู ุงูุญููุฉ ูุฏููุง ูุฑุตุฉ ุฌูุฏุฉ ูููุตูู ุฅูู ุงูุฃูุฏุงู ุงููุญุฏุฏุฉ. ููุน ุฐููุ ูุธู ููุงู ุจุนุถ ุงูุนูุงูู ุงููุชุบูุฑุฉ ูุซู ุงุณุชุฌุงุจุฉ ุงูุฌูููุฑ ุฃู ุงูุชุบูุฑุงุช ูู ุงูุณููุ ุงูุชู ูุฏ ุชุคุซุฑ ุนูู ุงููุชูุฌุฉ ุงูููุงุฆูุฉ.
    - ุจูุงุกู ุนูู ุฐููุ ููุจุบู ูุชุงุจุนุฉ ุงูุฃุฏุงุก ุนู ูุซุจ ูุฅุฌุฑุงุก ุงูุชุนุฏููุงุช ุงููุงุฒูุฉ ูุถูุงู ุชุญููู ุฃูุถู ูุชุงุฆุฌ.
    

    ๐ฌ **ุชุญููู ุงูููุฒุงุช ุงููุคุซุฑุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ:**  
"""

    for index, row in importance_df.iterrows():
        analysis += f"- **{row['ุงูููุฒุฉ']}**: ูุณุชูู ุชุฃุซูุฑู ุนูู ุงููุฌุงุญ ูู **{row['ุงูุฃูููุฉ']:.2f}**.\n"

    st.write(analysis)

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุตูุต ุงูุนุฑุจูุฉ
    importance_df["ุงูููุฒุฉ"] = importance_df["ุงูููุฒุฉ"].apply(lambda x: get_display(arabic_reshaper.reshape(x)))

    st.subheader("๐ ุฃูููุฉ ุงูููุฒุงุช ูู ุงุชุฎุงุฐ ุงููุฑุงุฑ")
    fig, ax = plt.subplots()

    # ุชูุนูู ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
    plt.rcParams['font.family'] = 'Arial'
    plt.rcParams['axes.unicode_minus'] = False

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุต ุงูุนุฑุจู ููุธูุฑ ุจุดูู ุตุญูุญ
    title = get_display(arabic_reshaper.reshape("ูุฎุทุท ุฃูููุฉ ุงูููุฒุงุช"))
    xlabel = get_display(arabic_reshaper.reshape("ุงูุฃูููุฉ"))
    ylabel = get_display(arabic_reshaper.reshape("ุงูููุฒุฉ"))

    # ุฑุณู ุงููุฎุทุท ุจุงุณุชุฎุฏุงู Seaborn
    sns.barplot(x="ุงูุฃูููุฉ", y="ุงูููุฒุฉ", data=importance_df, palette="viridis", ax=ax)

    # ุถุจุท ุนููุงู ุงููุฎุทุท ูุงูุนูุงููู ุงููุฑุนูุฉ
    ax.set_title(title, fontsize=16, fontweight='bold', fontname='Arial', loc='center')
    ax.set_xlabel(xlabel, fontsize=14, fontname='Arial')
    ax.set_ylabel(ylabel, fontsize=14, fontname='Arial')

    # ุถุจุท ุงุชุฌุงู ุงููุต ุนูู ุงููุญุงูุฑ
    plt.xticks(fontsize=12, fontname='Arial')
    plt.yticks(fontsize=12, fontname='Arial')

    # ููุจ ุชุฑุชูุจ ุงูููุฒุงุช ูุนุฑุถูุง ูู ุงูุฃุนูู ููุฃุณูู
    plt.gca().invert_yaxis()

    st.pyplot(fig)

    # ๐ ุชุญููู ูุฎุทุท ุฃูููุฉ ุงูููุฒุงุช
    # ุฅุนุงุฏุฉ ุชุดููู ุงููุตูุต ูู DataFrame ูุถูุงู ุธููุฑูุง ุจุดูู ุตุญูุญ
    ุงูููุฒุฉ_ุงูุฃูุซุฑ_ุฃูููุฉ = get_display(arabic_reshaper.reshape(importance_df.iloc[0]["ุงูููุฒุฉ"]))
    ุงูููุฒุฉ_ุงูุฃูู_ุฃูููุฉ = get_display(arabic_reshaper.reshape(importance_df.iloc[-1]["ุงูููุฒุฉ"]))

    st.markdown(f"""
        ๐ **ุชุญููู ุฃูููุฉ ุงูููุฒุงุช ูู ูุฌุงุญ ุงูุญููุงุช ุงูุชุณููููุฉ:**  

    ๐ ูุนูุณ ุงููุฎุทุท ุฃุนูุงู ูุฏู ุชุฃุซูุฑ ูู ููุฒุฉ ุนูู ูุฌุงุญ ุงูุญููุงุชุ ุญูุซ ุชูุธูุฑ ุงูุจูุงูุงุช ุฃู **ุงูููุฒุฉ ุงูุฃูุซุฑ ุฃูููุฉ** ูู **{ุงูููุฒุฉ_ุงูุฃูุซุฑ_ุฃูููุฉ}**.  
    ูุดูุฑ ุฐูู ุฅูู ุฃู ุงูุชุฑููุฒ ุนูู ุชุญุณูู ูุฐู ุงูููุฒุฉ ูููู ุฃู ูุนุฒุฒ ุฃุฏุงุก ุงูุญููุงุช ุงูุชุณููููุฉ ุจุดูู ูุจูุฑุ ูุธุฑุงู ูุฏูุฑูุง ุงููุญูุฑู ูู ุฌุฐุจ ุงูุฌูููุฑ ุงููุณุชูุฏู ูุชุญููู ุงูุฃูุฏุงู ุงูุชุณููููุฉ.  

    ๐น **ููุงุฐุง ูุฐู ุงูููุฒุฉ ูููุฉุ**  
    - ุชูุนุจ ุฏูุฑูุง ุฑุฆูุณููุง ูู ุชุญููุฒ ุชูุงุนู ุงูุนููุงุก ูุฒูุงุฏุฉ ูุนุฏู ุงูุชุญููู.  
    - ูุฏ ุชููู ูุฑุชุจุทุฉ ุจุฌูุฏุฉ ุงููุญุชููุ ุงุณุชูุฏุงู ุงูุฌูููุฑุ ุฃู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู.  
    - ุชุญุณูู ูุฐู ุงูููุฒุฉ ูุฏ ูุคุฏู ุฅูู ุชุญุณูู ุดุงูู ูู ุฃุฏุงุก ุงูุญููุฉ.  

        ๐ง **ูุงุฐุง ุนู ุงูููุฒุงุช ุงูุฃูู ุฃูููุฉุ**  
    ูู ูุงุญูุฉ ุฃุฎุฑูุ ุชูุธูุฑ ุงูุจูุงูุงุช ุฃู **{ุงูููุฒุฉ_ุงูุฃูู_ุฃูููุฉ}** ูู ุงูุฃูู ุชุฃุซูุฑูุง ุนูู ูุฌุงุญ ุงูุญููุงุช.  
    ูุฐุง ูุง ูุนูู ุฃููุง ุบูุฑ ุถุฑูุฑูุฉุ ูููู ูุฏ ูุง ูููู ุงูุงุณุชุซูุงุฑ ุงููุจูุฑ ูู ุชุญุณูููุง ุจููุณ ุงููุนุงููุฉ ููุงุฑูุฉู ุจุงูููุฒุงุช ุงูุฃูุซุฑ ุฃูููุฉ.  

        ๐ **ุชูุตูุงุช ุจูุงุกู ุนูู ุงูุชุญููู:**  
    โ **ุชุฑููุฒ ุงูุฌููุฏ ุนูู {ุงูููุฒุฉ_ุงูุฃูุซุฑ_ุฃูููุฉ}** ุนุจุฑ ุชุญุณูููุง ูุงุฎุชุจุงุฑ ุงุณุชุฑุงุชูุฌูุงุช ูุฎุชููุฉ ูุชุนุฒูุฒ ุชุฃุซูุฑูุง.  
    โ **ุนุฏู ุฅููุงู ุงูููุฒุงุช ุงูุฃุฎุฑู**ุ ูููู ูููู ุฅุนุงุฏุฉ ุชูุฒูุน ุงูููุงุฑุฏ ุจูุงุกู ุนูู ูุฏู ุชุฃุซูุฑ ูู ููุฒุฉ.  
    โ **ุชุญููู ูุชุบูุฑุงุช ุฃุฎุฑู** ูุฏ ุชุคุซุฑ ุนูู ุงููุฌุงุญุ ูุซู ุงูุชูุงุนู ูุน ุงูุฌูููุฑ ูุชุฎุตูุต ุงููุญุชูู ููููุง ูุงุญุชูุงุฌุงุช ุงูุนููุงุก.  

        ๐ ุจุงุณุชุฎุฏุงู ูุฐู ุงูุจูุงูุงุชุ ูููู ุชูุฌูู ุงูุงุณุชุซูุงุฑุงุช ุงูุชุณููููุฉ ุจุฐูุงุก ูุถูุงู ุชุญููู ุฃูุถู ุงููุชุงุฆุฌ ูุชุญุณูู ุงูุฃุฏุงุก ุงูุนุงู ููุญููุงุช. ๐
    """)

    # ๐ ุฑุณู ุงูุนูุงูุฉ ุจูู ุงูููุฒุงููุฉ ูุงููุฌุงุญ
    st.subheader("๐ธ ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ")
    fig2, ax2 = plt.subplots()

    # ุชูุนูู ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
    plt.rcParams['font.family'] = 'Arial'
    plt.rcParams['axes.unicode_minus'] = False

    # ุฑุณู ุงููุฎุทุท ูุน ุชุนุฏูู ุงูุชุตูููุงุช
    df["ุงููุฌุงุญ_ุงููุนุฏู"] = df["ุงููุฌุงุญ"].map({0: "ูุฌุงุญ", 1: "ูุดู"}).apply(lambda x: get_display(arabic_reshaper.reshape(x)))
    sns.boxplot(x="ุงููุฌุงุญ_ุงููุนุฏู", y="ุงูููุฒุงููุฉ", data=df, palette="cool", ax=ax2)

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุต ุงูุนุฑุจู ููุธูุฑ ุจุดูู ุตุญูุญ
    title = get_display(arabic_reshaper.reshape("ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ"))
    xlabel = get_display(arabic_reshaper.reshape("ุงููุฌุงุญ"))
    ylabel = get_display(arabic_reshaper.reshape("ุงูููุฒุงููุฉ"))

    # ุถุจุท ุนููุงู ุงููุฎุทุท ูุงูุนูุงููู ุงููุฑุนูุฉ
    ax2.set_title(title, fontsize=16, fontweight='bold', fontname='Arial', loc='center')
    ax2.set_xlabel(xlabel, fontsize=14, fontname='Arial')
    ax2.set_ylabel(ylabel, fontsize=14, fontname='Arial')

    # ุถุจุท ุงุชุฌุงู ุงููุต ุนูู ุงููุญุงูุฑ
    plt.xticks(fontsize=12, fontname='Arial')
    plt.yticks(fontsize=12, fontname='Arial')

    st.pyplot(fig2)

    # ๐ ุชุญููู ุงูุนูุงูุฉ ุจูู ุงูููุฒุงููุฉ ูุงููุฌุงุญ
    ูุชูุณุท_ููุฒุงููุฉ_ุงููุฌุงุญ = df[df["ุงููุฌุงุญ"] == "ูุฌุงุญ"]["ุงูููุฒุงููุฉ"].mean()
    ูุชูุณุท_ููุฒุงููุฉ_ุงููุดู = df[df["ุงููุฌุงุญ"] == "ูุดู"]["ุงูููุฒุงููุฉ"].mean()
    st.markdown(f"""
        ๐ **ุชุญููู ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ูุฌุงุญ ุงูุญููุงุช ุงูุชุณููููุฉ:**  

    ๐ ูู ุฎูุงู ุชุญููู ุงูุจูุงูุงุชุ ุชุจูู ุฃู **ุงููุชูุณุท ุงูุชูุฑูุจู ููููุฒุงููุฉ ูู ุงูุญููุงุช ุงููุงุฌุญุฉ** ูุจูุบ ุญูุงูู **{ูุชูุณุท_ููุฒุงููุฉ_ุงููุฌุงุญ:.2f} ุฏุฑูู**ุ  
    ุจูููุง **ุงููุชูุณุท ุงูุชูุฑูุจู ููููุฒุงููุฉ ูู ุงูุญููุงุช ุบูุฑ ุงููุงุฌุญุฉ** ูู **{ูุชูุณุท_ููุฒุงููุฉ_ุงููุดู:.2f} ุฏุฑูู**.  

    ๐ก **ูุง ุงูุฐู ุชุนููู ูุฐู ุงูุฃุฑูุงูุ**  
    - ููุธูุฑ ูุฐุง ุงูุชุญููู ุฃู ุงูุญููุงุช ุฐุงุช ุงูููุฒุงููุงุช ุงูุฃุนูู ุชููู ุฅูู ุชุญููู ูุฌุงุญ ุฃูุจุฑุ ููุง ูุดูุฑ ุฅูู ูุฌูุฏ ุนูุงูุฉ ุฅูุฌุงุจูุฉ ุจูู ุญุฌู ุงูููุฒุงููุฉ ููุณุชูู ุงูุฃุฏุงุก.  
    - ูุฏ ูููู ุฐูู ุจุณุจุจ ุงููุฏุฑุฉ ุนูู ุงูุงุณุชุซูุงุฑ ูู ุงุณุชุฑุงุชูุฌูุงุช ุชุณููููุฉ ุฃูุซุฑ ูุนุงููุฉุ ูุซู ุงุณุชูุฏุงู ุงูุฌูููุฑ ุงูููุงุณุจุ ูุงุณุชุฎุฏุงู ูุญุชูู ุนุงูู ุงูุฌูุฏุฉุ ูุงูุงุณุชูุงุฏุฉ ูู ุงูุฅุนูุงูุงุช ุงููุฏููุนุฉ ุจุดูู ุฃูุถู.  
    - ูู ุงูููุงุจูุ ูุฏ ุชุนุงูู ุงูุญููุงุช ุฐุงุช ุงูููุฒุงููุงุช ุงูููุฎูุถุฉ ูู ุถุนู ุงููุตูู ุฅูู ุงูุฌูููุฑ ุงููุณุชูุฏู ุฃู ูุญุฏูุฏูุฉ ุงูููุงุฑุฏ ุงููุงุฒูุฉ ูุชูููุฐ ุงุณุชุฑุงุชูุฌูุงุช ุชุณููููุฉ ูููุฉ.

        ๐ **ุชูุตูุงุช ุนูููุฉ ุจูุงุกู ุนูู ุงูุชุญููู:**  
    โ **ุฅุนุงุฏุฉ ุชูููู ุชูุฒูุน ุงูููุฒุงููุฉ:** ุงูุชุฑููุฒ ุนูู ุชุฎุตูุต ููุงุฑุฏ ูุงููุฉ ููุญููุงุช ุฐุงุช ุงูุนุงุฆุฏ ุงููุฑุชูุน.  
    โ **ุชุญุณูู ููุงุกุฉ ุงูุฅููุงู:** ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุชุญููู ุงูุจูุงูุงุช ูุถูุงู ุงุณุชุซูุงุฑ ุงูููุฒุงููุฉ ูู ุงููููุงุช ูุงูุฅุนูุงูุงุช ุงูุฃูุซุฑ ูุงุนููุฉ.  
    โ **ุชุฌุฑุจุฉ ุงุณุชุฑุงุชูุฌูุงุช ูุฎุชููุฉ:** ุงุฎุชุจุงุฑ ุญููุงุช ุจููุฒุงููุงุช ูุชุฏุฑุฌุฉ ููุนุฑูุฉ ุงูุญุฏ ุงูุฃุฏูู ุงููุนูุงู ูุชุญููู ุงููุฌุงุญ.  

        ๐ ุงูุงุณุชุซูุงุฑ ุงูุฐูู ูู ุงูุชุณููู ูููู ุฃู ูุคุฏู ุฅูู ุชุญุณูู ููุญูุธ ูู ูุนุฏูุงุช ุงููุฌุงุญุ ูุฐุง ูููุตุญ ุจูุถุน ุงุณุชุฑุงุชูุฌูุงุช ูุงููุฉ ูุจููุฉ ุนูู ุจูุงูุงุช ุฏูููุฉ ูุถูุงู ุชุญููู ุฃูุตู ุงุณุชูุงุฏุฉ ูู ุงูููุฒุงููุฉ.
    """)

    # ๐ก ุชุฃุซูุฑ ุงูููุงุฉ ุงูุชุณููููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ
    st.subheader("๐ก ุชุฃุซูุฑ ุงูููุงุฉ ุงูุชุณููููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ")
    fig3, ax3 = plt.subplots()

    # ุชูุนูู ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
    plt.rcParams['font.family'] = 'Arial'
    plt.rcParams['axes.unicode_minus'] = False

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุต ุงูุนุฑุจู ููุธูุฑ ุจุดูู ุตุญูุญ
    title = get_display(arabic_reshaper.reshape("ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ"))
    xlabel = get_display(arabic_reshaper.reshape("ุงูููุงุฉ ุงูุชุณููููุฉ"))
    ylabel = get_display(arabic_reshaper.reshape("ุนุฏุฏ ุงูุญููุงุช"))
    legend_title = get_display(arabic_reshaper.reshape("ุงููุฌุงุญ"))

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุตูุต ุงูุนุฑุจูุฉ ูู ุงูููุงุฉ ูุงููุฌุงุญ
    df["ุงูููุงุฉ_ุงููุนุฏูุฉ"] = df["ุงูููุงุฉ"].map({
        0: "ุฅุนูุงูุงุช ุฑูููุฉ",
        1: "ูุณุงุฆู ุงูุชูุงุตู",
        2: "ุชููุฒููู",
        3: "ุฑุงุฏูู",
        4: "ุจุฑูุฏ ุฅููุชุฑููู"
    }).apply(lambda x: get_display(arabic_reshaper.reshape(x)))

    # ุฑุณู ุงููุฎุทุท ูุน ุงุณุชุฎุฏุงู ุงูุฃุนูุฏุฉ ุงููุนุฏูุฉ
    sns.countplot(
        data=df,
        x="ุงูููุงุฉ_ุงููุนุฏูุฉ",
        hue="ุงููุฌุงุญ_ุงููุนุฏู",
        palette="cool",
        ax=ax3
    )

    # ุฅุนุงุฏุฉ ุชุดููู ุงููุตูุต ูุนูุงููู ุงููุฎุทุท
    ax3.set_title(get_display(arabic_reshaper.reshape("ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ")), fontsize=16, fontweight='bold')
    ax3.set_xlabel(get_display(arabic_reshaper.reshape("ุงูููุงุฉ ุงูุชุณููููุฉ")), fontsize=14)
    ax3.set_ylabel(get_display(arabic_reshaper.reshape("ุนุฏุฏ ุงูุญููุงุช")), fontsize=14)

    # ุฅุถุงูุฉ ูุณููุฉ ุงูุฅูุถุงุญ
    ax3.legend(title=get_display(arabic_reshaper.reshape("ุงููุฌุงุญ")), fontsize=12, title_fontsize=14, loc="upper right")

    # ุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฎุทูุท
    plt.xticks(fontsize=12)
    plt.yticks(fontsize=12)

    st.pyplot(fig3)

    # Convert back 'ุงูููุงุฉ' to categorical for proper ordering
    df_for_analysis = df.copy()
    df_for_analysis["ุงูููุงุฉ"] = df_for_analysis["ุงูููุงุฉ"].map({
            0: "ุฅุนูุงูุงุช ุฑูููุฉ",
            1: "ูุณุงุฆู ุงูุชูุงุตู",
            2: "ุชููุฒููู",
            3: "ุฑุงุฏูู",
            4: "ุจุฑูุฏ ุฅููุชุฑููู"
        }).astype("category")

    # Calculate Success Rates per Channel
    ูุนุฏูุงุช_ูุฌุงุญ_ุงููููุงุช = df_for_analysis.groupby("ุงูููุงุฉ")["ุงููุฌุงุญ"].apply(lambda x: (x == "ูุฌุงุญ").mean()).sort_values(ascending=False)

    # Identify Best & Worst Channels
    ุฃูุถู_ููุงุฉ = ูุนุฏูุงุช_ูุฌุงุญ_ุงููููุงุช.idxmax()
    ูุนุฏู_ูุฌุงุญ_ุฃูุถู_ููุงุฉ = ูุนุฏูุงุช_ูุฌุงุญ_ุงููููุงุช.max() * 100
    ุฃุณูุฃ_ููุงุฉ = ูุนุฏูุงุช_ูุฌุงุญ_ุงููููุงุช.idxmin()
    ูุนุฏู_ูุฌุงุญ_ุฃุณูุฃ_ููุงุฉ = ูุนุฏูุงุช_ูุฌุงุญ_ุงููููุงุช.min() * 100

    # ๐ ุชุญููู ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ
    st.markdown(f"""
        ๐ **ุชุญููู ุฃุฏุงุก ุงูุญููุงุช ุงูุชุณููููุฉ ุญุณุจ ุงูููุงุฉ:**

    ููุดู ุชุญููู ุงูุจูุงูุงุช ุฃู ุงูููุงุฉ ุงูุฃูุซุฑ ูุฌุงุญูุง ูู **{ุฃูุถู_ููุงุฉ}**ุ ุญูุซ ุญููุช ูุณุจุฉ ูุฌุงุญ ุจูุบุช ุญูุงูู **{ูุนุฏู_ูุฌุงุญ_ุฃูุถู_ููุงุฉ:.2f} ูู ุงููุฆุฉ**.  
    ูุดูุฑ ูุฐุง ุฅูู ุฃู ูุฐู ุงูููุงุฉ ุชุณุงูู ุจุดูู ูุจูุฑ ูู ุชุญููู ุงูุฃูุฏุงู ุงูุชุณููููุฉุ ููุง ูุฌุนููุง ุฎูุงุฑูุง ูุซุงูููุง ูุชูุฌูู ุงููุฒูุฏ ูู ุงูุงุณุชุซูุงุฑุงุช ูุงูุฌููุฏ ุงูุชุณููููุฉ.  

    ูู ูุงุญูุฉ ุฃุฎุฑูุ ุชูุธูุฑ ุงูุจูุงูุงุช ุฃู ุงูููุงุฉ ุงูุฃูู ูุฌุงุญูุง ูู **{ุฃุณูุฃ_ููุงุฉ}**ุ ูุน ูุณุจุฉ ูุฌุงุญ ุชุจูุบ ุญูุงูู **{ูุนุฏู_ูุฌุงุญ_ุฃุณูุฃ_ููุงุฉ:.2f} ูู ุงููุฆุฉ**.  
    ูุฏ ูุนูุฏ ุฐูู ุฅูู ุนูุงูู ูุฎุชููุฉ ูุซู ุถุนู ุงูุชูุงุนูุ ุนุฏู ููุงุกูุฉ ุงููุญุชูู ููุฌูููุฑ ุงููุณุชูุฏูุ ุฃู ุงูุญุงุฌุฉ ุฅูู ุชุญุณูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชูููุฐ.

    ๐ **ุชูุตูุงุช ุจูุงุกู ุนูู ุงูุชุญููู:**  
    - ุงูุชุฑููุฒ ุนูู **{ุฃูุถู_ููุงุฉ}** ูููุงุฉ ุฑุฆูุณูุฉ ูุชุนุฒูุฒ ุงูุญููุงุช ุงูุชุณููููุฉ ูุฒูุงุฏุฉ ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ.  
    - ุชุญููู ุฃุณุจุงุจ ุถุนู ุฃุฏุงุก **{ุฃุณูุฃ_ููุงุฉ}**ุ ูุฅุฌุฑุงุก ุชุญุณููุงุช ุนูู ุงุณุชุฑุงุชูุฌูุงุชูุง ุฃู ุฅุนุงุฏุฉ ุชุฎุตูุต ุงูููุฒุงููุฉ ููููุงุช ุฃูุซุฑ ูุงุนููุฉ.  
    - ุงูุงุณุชูุงุฏุฉ ูู ุงูุจูุงูุงุช ูุชุญุณูู ุงุณุชูุฏุงู ุงูุฌูููุฑ ูุชุนุฒูุฒ ุงูุชูุงุนู ุนุจุฑ ุงููููุงุช ุงููุฎุชููุฉ ูุถูุงู ุชุญููู ุฃูุตู ุงุณุชูุงุฏุฉ ูู ุงูููุฒุงููุฉ ุงูุชุณููููุฉ.
    """)
else:
    # ุนุฑุถ ุฑุณุงูุฉ ูููุณุชุฎุฏู ูุจู ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุญููู
    st.info("๐ ูุฑุฌู ุฅุฏุฎุงู ุจูุงูุงุช ุงูุญููุฉ ุงูุชุณููููุฉ ุซู ุงูุถุบุท ุนูู ุฒุฑ 'ุชุญููู ุงูุจูุงูุงุช' ููุญุตูู ุนูู ุงูุชุญููู ุงูุดุงูู.")
